<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>LCMAP @ USGS EROS - Client Library Documentation</title>

    <link href="css/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="css/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="js/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","python","vb","clojure","ruby"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <div class="content"><span class="title">LCMAP @ USGS EROS - Client Library Documentation</span></div>
      </span>
    </a>
    <div class="tocify-wrapper">
      <div class="content">
        <div class="logo">
        </div>
        <span class="title">LCMAP @ USGS EROS - Client Library Documentation</span></div>
        <div class="lang-selector">
              <a href="#" data-language-name="shell">cURL</a>
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="vb">Julia</a>
              <a href="#" data-language-name="clojure">Clojure</a>
              <a href="#" data-language-name="ruby">Ruby</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/USGS-EROS/lcmap-client-docs/'>View the source</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="introduction">Introduction</h1>

<p><em>Developer documentation for the family of LCMAP clients</em></p>

<p><a href="images/lcmap-logo-1-1000px.png"><img src="images/lcmap-logo-1-250px.png" /></a></p>

<h2 id="about-lcmap">About LCMAP</h2>

<p>The intent of the Land Change Monitoring Assessment and Projection (LCMAP) initiative is to enable analysis of a very large amount of continuously acquired data to understand historical trends, assess current states, and project future states at regular intervals.</p>

<p>The system capacity and functionality needed to support the magnitude of long-term time series analysis is expected to employ Earth data science, demanding highly specialized computing environments to execute large scale analysis.</p>

<h3 id="land-change">Land Change</h3>

<p>Land-change science is about understanding changes in the type, intensity, condition, and location of land use and cover as indications of possible impacts to and from the interactions between people and nature.</p>

<p>Toward this aim, the LCMAP system&rsquo;s goals are to:</p>

<ol>
<li><p>Provide users and science models with direct access to a vast amount of Analysis Ready Data.</p></li>
<li><p>Assess and project changes to land cover, use, and condition.</p></li>
<li><p>Provide science users the means to continuously monitor and classify changes.</p></li>
<li><p>Support decision making relevant to environmental management and policy.</p></li>
<li><p>Enable discovery and distribution of information derived by science models through many channels, to many user communities.</p></li>
</ol>

<h3 id="system-architecture">System Architecture</h3>

<p>The system architecture and the components of which it is comprised has been designed to fulfill the LCMAP science user experience:</p>

<ol>
<li><p>Access and Exploration - enables discovery, visualization, reporting, notification, and other access methods via REST resources and GIS standards for services and file formats.</p></li>
<li><p>Subscription and notification services - allows science users to continuously monitor land change data for events of particular interest.</p></li>
<li><p>Science Execution Environment (SEE) - enables rapid development, production, validation and deployment of science models.</p></li>
<li><p>Information Warehouse and Data Store - contains decades of Analysis Ready Data as well as new data as it is obtained from satellites and science model outputs.</p></li>
<li><p>Client Libraries, Documentation, and Tutorials - enable science users to automate the collection and processing of land change data and develop new science models.</p></li>
</ol>

<h2 id="the-rest-service">The REST Service</h2>

<p>Since the LCMAP system service provides REST resource over HTTP, all of the client libraries are essentially wrappers around HTTP client libraries. To provide the best possible developer experience, these libraries strive to handle configuration, cumbersom tasks, or multiple calls as cleanly as possible with as little direct intervention on the part of the user as makes good, clean sense.</p>

<h2 id="users-and-roles">Users and Roles</h2>

<p>In order to use the LCMAP service, you need to be authenticated as a value user. To do this, you will need to register an account with the <a href="https://ers.cr.usgs.gov/login/">USGS ERS</a> service (or use an existing one). Registration is simple and only takes a few seconds. After submitting your registration and verifying your email address, you will be ready to use the LCMAP REST service.</p>

<h2 id="important-developer-notes">Important Developer Notes</h2>

<p>That being said, there are key things every developer should keep in mind, in order to better understand how the LCMAP service and its associated libraries work. This will aide in better code and provide the proper background in the event that debugging becomes necessary in your project.</p>

<p>Important things to note and remember:</p>

<ul>
<li>There is no version number in the URL; the version is passed in an <code class="prettyprint">Accept</code>
header.</li>
<li>File extensions in a query string (e.g., <code class="prettyprint">/some-resource?xml</code>) are not
used to determine the content type; this is done using headers (<code class="prettyprint">Accept</code>
and <code class="prettyprint">Content-Type</code>).</li>
<li>An authentication token is used in place of an API key; this is handled for
you automatically as soon as you have logged in to the USGS authentication
service.</li>
</ul>

<h2 id="conventions">Conventions</h2>

<p>We use styled call-outs to provide immediate visual cues about the nature of
the information being shared.</p>

<p>These are as follows:</p>

<aside class="info">
This style indicates useful information, background, or other insights.
</aside>

<aside class="success">
This style indicates a best practice, good usage, and other tips for success.
</aside>

<aside class="caution">
This style indicates one should use caution or that behaviour may not be as
expected
</aside>

<aside class="danger">
This style indicates information that could cause errors if ignored.
</aside>

<h2 id="http-clients">HTTP Clients</h2>

<p>Due to the nature of the LCMAP initiative, the supporting infrastrucuture is diverse and multi-faceted. Development on the system is on-going and subject to a great deal of change &ndash; as such, there may be a lag between what exists in the code and what has been documented on this site.</p>

<p>Even while the greater LCMAP systm is under development, we are creating client libraries. We decided to to this early in the process, with the understanding that the overhead of maintaining a moving target is far out-weighed by the benefits of engaging with the science and development communities from the very beginning.</p>

<h2 id="using-curl">Using cURL</h2>

<blockquote>
<p>All cURL requests need to provide the version of the API you with to access in the <code class="prettyprint">Accept</code> header:</p>
</blockquote>
<pre class="highlight shell"><code>curl -s -X POST <span class="se">\</span>
  -H <span class="s2">"Accept: application/vnd.usgs.lcmap.v0.0+json"</span> <span class="se">\</span>
  -d <span class="s2">"username=</span><span class="sb">`</span>cat ~/.usgs/username<span class="sb">`</span><span class="s2">"</span> <span class="se">\</span>
  -d <span class="s2">"password=</span><span class="sb">`</span>cat ~/.usgs/password<span class="sb">`</span><span class="s2">"</span> <span class="se">\</span>
  http://localhost:1077/api/auth/login | <span class="se">\</span>
  jq -r <span class="s1">'.token'</span>
</code></pre>
<pre class="highlight shell"><code>3efc6475b5034309af00549a77b7a6e3
</code></pre>

<blockquote>
<p>After authenticating, all cURL requests need to provide your access key via the <code class="prettyprint">X-AuthToken</code> header:</p>
</blockquote>
<pre class="highlight shell"><code>curl -s -X POST <span class="se">\</span>
  -H <span class="s2">"Accept: application/vnd.usgs.lcmap.v0.0+json"</span> <span class="se">\</span>
  -H <span class="s2">"X-AuthToken: 3efc6475b5034309af00549a77b7a6e3"</span> <span class="se">\</span>
  <span class="s1">'http://localhost:1077/api/L3/sample/model?seconds=15&amp;year=2016'</span>
</code></pre>
<pre class="highlight shell"><code><span class="o">{</span><span class="s2">"result"</span>:<span class="o">{</span><span class="s2">"link"</span>:<span class="s2">"/api/L3/sample/model/a4881a10c0026ee8bb4a50556bd665bc"</span><span class="o">}}</span>
</code></pre>

<p>There are two ways in which one may interact with the LCMAP system as a
client:</p>

<ul>
<li>Directly, accessing the REST resources with <code class="prettyprint">cURL</code></li>
<li>Client libraries</li>
</ul>

<p>The client libraries will be discussed in the next section; right now, we will provide an overview of things to keep in mind when using cURL:</p>

<ul>
<li>Since muliple versions of the API are supported and we do not support versions in the URL, every request must include the version in an <code class="prettyprint">Accept</code> header.</li>
</ul>

<p>See the notes to the right for details.</p>

<p>Note that one cURL example assumes that you have created the directory <code class="prettyprint">~/.usgs</code> and have saved your <a href="https://ers.cr.usgs.gov/login/">USGS ERS</a> username in <code class="prettyprint">~/.usgs/username</code> your password in <code class="prettyprint">~/.usgs/password</code>.</p>

<aside class="info">
To parse the JSON results in cURL, the <code>jq</code> command line utility is being used. See the <a href="https://stedolan.github.io/jq/">jq site</a> for more details.
</aside>

<ul>
<li>The API token needs to be passed with every request as an <code class="prettyprint">X-AuthToken</code> header.</li>
</ul>

<aside class="caution">
ERS tokens (what LCMAP uses behind the scenes) expire every two hours. When you get an HTTP 403 response, you will need to obtain a new token by authenticating against LCMAP again.
</aside>

<h2 id="api-organization">API Organization</h2>

<p>The LCMAP REST service and client APIs have been organized into several key areas:</p>

<ul>
<li><strong>General</strong> calls such as client initialization and user authentication</li>
<li><strong>Querying</strong> calls such as for Analysis Ready Data (ARD) or previous results from executing supported science models</li>
<li><strong>Subscription</strong> calls related to services for notifying users of subscribed land-change events</li>
<li><strong>Model Execution</strong> calls such as performing runs to build model data based on previous stored data or making predictions based on previous model runs</li>
<li><strong>Management</strong> calls such as system status, maintaining users, and modifying roles</li>
</ul>

<p>Each of these is discussed in more detail below.</p>

          <h1 id="development-environment">Development Environment</h1>

<blockquote>
<p>Environment variable configuration:</p>
</blockquote>
<pre class="highlight plaintext"><code>TBD
</code></pre>

<blockquote>
<p>LCMAP client configuration file change:</p>
</blockquote>
<pre class="highlight plaintext"><code>TBD
</code></pre>

<blockquote>
<p>LCMAP client arguments:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># No client arguments for cURL</span>
</code></pre>
<pre class="highlight python"><code><span class="n">Python</span><span class="p">:</span> <span class="n">TBD</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">Julia</span><span class="p">:</span> <span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">Clojure</span><span class="err">:</span><span class="w"> </span><span class="n">TBD</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">Ruby</span><span class="p">:</span> <span class="no">TBD</span>
</code></pre>

<p>If you wish to develop client libraries for the LCMAP system, it may be more convenient to run a local instance of the development environment. The steps required for this are the following:</p>

<ul>
<li>Install Cassandra, Mesos, and Leiningen</li>
<li>Start Cassandra: <code class="prettyprint">cassandra -f</code></li>
<li>Set up Cassandra schemas [link TBD]</li>
<li>Ingest sample data [link TBD]</li>
<li>Start testing auth service: <code class="prettyprint">cd lcmap-rest/test/support/auth-server &amp;&amp; lein run</code></li>
<li>Update the <code class="prettyprint">lcmap-rest/project.clj</code> dev environment configuration setting for <code class="prettyprint">auth-server</code></li>
<li>Start lcmap-rest suite of services: <code class="prettyprint">cd lcmap-rest &amp;&amp; lein with-profile dev run</code></li>
</ul>

<p>At this point you may develop against the lcmap-rest services you have running locally by configuring your client(s) to use the local service as the LCMAP REST endpoint. You can do this with environment variables or by editing the LCMAP client configuration file.</p>

          <h1 id="the-client-libraries">The Client Libraries</h1>

<h2 id="language-bindings-amp-status">Language Bindings &amp; Status</h2>

<blockquote>
<p>Development status of your client:</p>
</blockquote>
<pre class="highlight shell"><code>cURL Status: IN PROGRESS
</code></pre>
<pre class="highlight python"><code><span class="n">Python</span> <span class="n">Status</span><span class="p">:</span> <span class="n">IN</span> <span class="n">PROGRESS</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">Julia</span> <span class="n">Status</span><span class="p">:</span> <span class="n">INITIAL</span> <span class="n">STAGES</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">Clojure</span><span class="w"> </span><span class="n">Status</span><span class="err">:</span><span class="w"> </span><span class="n">IN</span><span class="w"> </span><span class="n">PROGRESS</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">Ruby</span> <span class="no">Status</span><span class="p">:</span> <span class="no">NOT</span> <span class="no">STARTED</span>
</code></pre>

<p>We plan to provide the following client libraries for LCMAP:</p>

<ul>
<li>Python <span class="status-in-progress">[IN PROGRESS]</span></li>
<li>Julia <span class="status-initial-stages">[INITIAL STAGES]</span></li>
<li>Clojure <span class="status-in-progress">[IN PROGRESS]</span></li>
<li>Ruby <span class="status-not-started">[NOT STARTED]</span></li>
</ul>

<h2 id="viewing-per-language-examples">Viewing Per-language Examples</h2>

<p>cURL and client access are demonstrated in the following document while using the same prose for describing the overall experience.</p>

<p>To view example code for any one of the language-specific libraries, be sure to select the appropriate tab in the upper-right of this documentation site.</p>

<h2 id="installation">Installation</h2>

<blockquote>
<p>Install your client with the following:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># cURL installation is OS-dependent. For Ubuntu command-line:</span>
sudo apt-get install curl
</code></pre>
<pre class="highlight python"><code><span class="c"># Until the LCMAP Python client library is released in PyPI, use git:</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github.com</span><span class="p">:</span><span class="n">USGS</span><span class="o">-</span><span class="n">EROS</span><span class="o">/</span><span class="n">lcmap</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">py</span><span class="o">.</span><span class="n">git</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">git</span> <span class="n">clone</span> <span class="n">git@github</span><span class="p">.</span><span class="n">com</span><span class="p">:</span><span class="n">USGS</span><span class="o">-</span><span class="n">EROS</span><span class="o">/</span><span class="n">lcmap</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">jl</span><span class="p">.</span><span class="n">git</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">lcmap</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">jl</span> <span class="err">~</span><span class="o">/</span><span class="p">.</span><span class="n">julia</span><span class="o">/</span><span class="n">v0</span><span class="p">.</span><span class="err">4/</span><span class="n">LCMAPClient</span>
</code></pre>
<pre class="highlight clojure"><code><span class="c1">;; Until the LCMAP Clojure client library is released in Clojars, use git:
</span><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">git</span><span class="err">@</span><span class="n">github.com</span><span class="no">:USGS-EROS/lcmap-client-clj.git</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="c1"># There's not currently a Ruby client repo</span>
</code></pre>

<p>Installation is dependent upon the client you want to use. How cURL gets installed is dependent upon your operating system , development platform, and/or package manager.</p>

<p>The client library installations each have their own method of installation. See the notes to the right for per-language details.</p>

<h2 id="configuration">Configuration</h2>

<p>Default user configuration should be saved in an LCMAP configuration file. Values stored here may be overridden by setting specific environment variables in your system shell.</p>

<h3 id="config-ini-file">Config/INI File</h3>

<blockquote>
<p>Set up your username and password.</p>
</blockquote>
<pre class="highlight shell"><code>mkdir ~/.usgs
<span class="nb">echo</span> <span class="s2">"alice"</span> &gt; cat ~/.usgs/username
<span class="nb">echo</span> <span class="s2">"secret"</span> &gt; cat ~/.usgs/password
</code></pre>

<blockquote>
<p>The <code class="prettyprint">~/.usgs/lcmap.ini</code> is used by client libraries (but not cURL) to access user-configurable data. Here is a sample configuration:</p>
</blockquote>
<pre class="highlight ini"><code><span class="nn">[LCMAP Client]</span>
<span class="py">username</span> <span class="p">=</span> <span class="s">alice</span>
<span class="py">password</span> <span class="p">=</span> <span class="s">secret</span>
</code></pre>

<blockquote>
<p>For the testing auth server you can use &ldquo;alice&rdquo; as the username and &ldquo;secret&rdquo; as the password. For accessing the production LCMAP service, you will use your <a href="https://ers.cr.usgs.gov/login/">USGS ERS</a> credentials</p>
</blockquote>
<pre class="highlight plaintext"><code></code></pre>

<blockquote>
<p>Be sure to protect your configuration files, especially if they contain sensitive information:</p>
</blockquote>
<pre class="highlight plaintext"><code>chmod 600 ~/.usgs/*
</code></pre>

<p>All the LCMAP client libraries use the same <code class="prettyprint">~/.usgs/lcmap.ini</code> configuration file and the same format (Config/INI). In particular, data that is applicable to LCMAP clients is stored in the <code class="prettyprint">LCMAP Client</code> section of this configuration file.</p>

<p>Currently, the following keys are defined for the <code class="prettyprint">LCMAP Client</code> section:</p>

<ul>
<li><code class="prettyprint">username</code> - your ERS username</li>
<li><code class="prettyprint">password</code> - your ERS password</li>
<li><code class="prettyprint">version</code> - version of the REST service you wish to use (server-side)</li>
<li><code class="prettyprint">endppoint</code> - base URL of the REST service (if other than production)</li>
<li><code class="prettyprint">content-type</code> - override the default content type of returned data</li>
<li><code class="prettyprint">log-level</code> - verbosity of logged output (most verbose to least: <code class="prettyprint">all</code>, <code class="prettyprint">trace</code>, <code class="prettyprint">debug</code>, <code class="prettyprint">info</code>, <code class="prettyprint">warn</code>, <code class="prettyprint">error</code>, and <code class="prettyprint">none</code>)</li>
<li><code class="prettyprint">logging-namespaces</code> - space-separated namespaces to log</li>
</ul>

<p>The values for the username and password keys are used to obtain the LCMAP token from an authentication server (both the production ERS server and the testing server provided in <code class="prettyprint">lcmap-rest/test/aupport/auth-server</code>).</p>

<p>Each client library provides a sample <code class="prettyprint">lcmap.ini</code> which you may use to create your own. To esaily set up your own, simply do: <code class="prettyprint">cp examples/lcmap.ini ~/.usgs/lcmap.ini</code>. You will need to update the ERS username and password, though!</p>

<aside class="caution">
cURL is a special case, being a command line tool. It doesn&rsquo;t use the <code>~/usgs/lcmap.ini</code> file, rather it can be used to <code>cat</code> plain text files.
</aside>

<h3 id="env-variables">ENV Variables</h3>

<p>Environment variable are also supported. They offer an easy and standard way to override configured defaults. The following environment variables are defined for LCMAP:</p>

<ul>
<li><code class="prettyprint">LCMAP_USERNAME</code></li>
<li><code class="prettyprint">LCMAP_PASSWORD</code></li>
<li><code class="prettyprint">LCMAP_VERSION</code></li>
<li><code class="prettyprint">LCMAP_ENDPOINT</code></li>
<li><code class="prettyprint">LCMAP_CONTENT_TYPE</code></li>
<li><code class="prettyprint">LCMAP_LOG_LEVEL</code></li>
<li><code class="prettyprint">LCMAP_LOGGING_NAMESPACES</code></li>
</ul>

<p>Note that defining any one these will override the corresponding value in <code class="prettyprint">~/.usgs/lcmap.ini</code>.</p>

          <h1 id="api-general">API: General</h1>

<h2 id="client-initialization">Client Initialization</h2>
<pre class="highlight shell"><code><span class="nv">LCMAP_ENDPOINT</span><span class="o">=</span>http://localhost:1077
<span class="nv">LCMAP_VERSION_HDR</span><span class="o">=</span><span class="s2">"Accept: application/vnd.usgs.lcmap.v0.0+json"</span>
</code></pre>
<pre class="highlight python"><code><span class="kn">from</span> <span class="nn">lcmap_client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>

<span class="c"># This will read your ERS username and password from ENV variables or</span>
<span class="c"># the lcmap.ini configuration file and authenticate against the LCMAP service.</span>
<span class="c"># It uses the Requests library's session management and keep-alive</span>
<span class="c"># functionality in subsequent calls.</span>

<span class="c"># Upon successful instantiation, the auth component will be populated with the</span>
<span class="c"># user login data</span>
<span class="n">client</span><span class="o">.</span><span class="n">auth</span>
<span class="p">{</span><span class="s">'email'</span><span class="p">:</span> <span class="s">'alice@usgs.gov'</span><span class="p">,</span>
 <span class="s">'roles'</span><span class="p">:</span> <span class="p">[</span><span class="s">'RPUBLIC'</span><span class="p">,</span> <span class="s">'LANDSAT8CUST'</span><span class="p">],</span>
 <span class="s">'token'</span><span class="p">:</span> <span class="s">'3efc6475b5034309af00549a77b7a6e3'</span><span class="p">,</span>
 <span class="s">'user-id'</span><span class="p">:</span> <span class="s">'001010111'</span><span class="p">,</span>
 <span class="s">'username'</span><span class="p">:</span> <span class="s">'alice'</span><span class="p">}</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">lcmap-client.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">lcmap</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="p">(</span><span class="nf">lcmap/connect</span><span class="p">))</span><span class="w">

</span><span class="c1">; This will read your ERS username and password from ENV variables or
; the lcmap.ini configuration file, authenticate against the LCMAP service,
; and then create a client connection pool that will be used in subsequent
; requests to the LCMAP service.
</span><span class="w">
</span><span class="c1">; Note that the connect function's return vallue is used in all subsequent
; client function calls.
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<p>The degree to which client libraries perform an initialization setp varies from language to language. cURL, by virtue of it being a command line utility, is pretty open-ended; we use <code class="prettyprint">ENV</code> variables to &ldquo;initialize&rdquo; it. While functional programming languages like Clojure don&rsquo;t typically have the concept of objects, specialized data structures are used, and these need to be set up ahead of time. Client libraries for object-oriented languages such as Python and Ruby do typical object instantiation during this step.</p>

<h2 id="authentication">Authentication</h2>

<blockquote>
<p>Manual authentication will return user data:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nv">LCMAP_USER_DATA</span><span class="o">=</span><span class="k">$(</span>curl -s -X POST -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> <span class="se">\</span>
  -d <span class="s2">"username=</span><span class="sb">`</span>cat ~/.usgs/username<span class="sb">`</span><span class="s2">"</span> <span class="se">\</span>
  -d <span class="s2">"password=</span><span class="sb">`</span>cat ~/.usgs/password<span class="sb">`</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nv">$LCMAP_ENDPOINT</span>/api/auth/login<span class="k">)</span>
</code></pre>
<pre class="highlight python"><code><span class="c"># The Python client automatically logs you in upon instantiation, so there is</span>
<span class="c"># generally no need to manually authenticate.</span>

<span class="c"># However, should you ever wish to do so, you may call the following method:</span>
<span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">"alice"</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">"secret"</span><span class="p">)</span>
<span class="p">{</span><span class="s">'email'</span><span class="p">:</span> <span class="s">'alice@usgs.gov'</span><span class="p">,</span>
 <span class="s">'roles'</span><span class="p">:</span> <span class="p">[</span><span class="s">'RPUBLIC'</span><span class="p">,</span> <span class="s">'LANDSAT8CUST'</span><span class="p">],</span>
 <span class="s">'token'</span><span class="p">:</span> <span class="s">'3efc6475b5034309af00549a77b7a6e3'</span><span class="p">,</span>
 <span class="s">'user-id'</span><span class="p">:</span> <span class="s">'001010111'</span><span class="p">,</span>
 <span class="s">'username'</span><span class="p">:</span> <span class="s">'alice'</span><span class="p">}</span>

</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="c1">; The client connection function automatically authenticates you, so there
; is generally no need to manually call an authentication function when using
; the Clojure LCMAP client library.
</span><span class="w">
</span><span class="c1">; Should you ever wish to do so, you may call the following:
</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">lcmap-client.auth</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">auth</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nf">auth/login</span><span class="w"> </span><span class="no">:username</span><span class="w"> </span><span class="s">"alice"</span><span class="w"> </span><span class="no">:password</span><span class="w"> </span><span class="s">"secret"</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="no">:user-id</span><span class="w"> </span><span class="s">"001010111"</span><span class="n">,</span><span class="w">
 </span><span class="no">:username</span><span class="w"> </span><span class="s">"alice"</span><span class="n">,</span><span class="w">
 </span><span class="no">:roles</span><span class="w"> </span><span class="p">[</span><span class="s">"RPUBLIC"</span><span class="w"> </span><span class="s">"LANDSAT8CUST"</span><span class="p">]</span><span class="n">,</span><span class="w">
 </span><span class="no">:email</span><span class="w"> </span><span class="s">"alice@usgs.gov"</span><span class="n">,</span><span class="w">
 </span><span class="no">:token</span><span class="w"> </span><span class="s">"3efc6475b5034309af00549a77b7a6e3"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<p>In LCMAP, the process of authentication (for most clients, this is done automatically), returns metadata for the authenticated user. This includes such data as an API token, a user id, a username, the primary email address for the ERS account, and the roles the user has been granted via ERS and LCMAP.</p>

<aside class="info">
Remember, to authenticate against the LCMAP service you will need to have registered with the <a href="https://ers.cr.usgs.gov/login/">USGS ERS</a> service.
</aside>

<h2 id="user-data">User Data</h2>

<blockquote>
<p>Get the token value:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nv">LCMAP_TOKEN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$LCMAP_USER_DATA</span> | <span class="se">\</span>
  jq -r <span class="s1">'.result.token'</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$LCMAP_TOKEN</span>
3efc6475b5034309af00549a77b7a6e3

<span class="c"># For subsequent cURL commands, we'll need the HTTP X-AuthToken header</span>
<span class="c"># to be set; we can define that now that we have the token value:</span>
<span class="nv">LCMAP_TOKEN_HDR</span><span class="o">=</span><span class="s2">"X-AuthToken: </span><span class="nv">$LCMAP_TOKEN</span><span class="s2">"</span>
</code></pre>
<pre class="highlight python"><code><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span>
<span class="s">u'3efc6475b5034309af00549a77b7a6e3'</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">lcmap-client.auth</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">auth</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nf">auth/get-token</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w">
</span><span class="s">"3efc6475b5034309af00549a77b7a6e3"</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>Get the username value:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nb">echo</span> <span class="nv">$LCMAP_USER_DATA</span> | <span class="se">\</span>
  jq -r <span class="s1">'.result.username'</span>
alice
</code></pre>
<pre class="highlight python"><code><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
<span class="s">u'alice'</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">auth/get-username</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w">
</span><span class="s">"alice"</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>Get the roles:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nb">echo</span> <span class="nv">$LCMAP_USER_DATA</span> | <span class="se">\</span>
  jq -r <span class="s1">'.result.roles'</span>
<span class="o">[</span>
  <span class="s2">"RPUBLIC"</span>,
  <span class="s2">"LANDSAT8CUST"</span>
<span class="o">]</span>
</code></pre>
<pre class="highlight python"><code><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_roles</span><span class="p">()</span>
<span class="p">[</span><span class="s">u'RPUBLIC'</span><span class="p">,</span> <span class="s">u'LANDSAT8CUST'</span><span class="p">]</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">auth/get-roles</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="s">"RPUBLIC"</span><span class="w"> </span><span class="s">"LANDSAT8CUST"</span><span class="p">]</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>Get the primary email address:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nb">echo</span> <span class="nv">$LCMAP_USER_DATA</span> | <span class="se">\</span>
  jq -r <span class="s1">'.result.email'</span>
alice@usgs.gov
</code></pre>
<pre class="highlight python"><code><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_email</span><span class="p">()</span>
<span class="s">u'alice@usgs.gov'</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">auth/get-email</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w">
</span><span class="s">"alice@usgs.gov"</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>Get the user-id value:</p>
</blockquote>
<pre class="highlight shell"><code><span class="nb">echo</span> <span class="nv">$LCMAP_USER_DATA</span> | <span class="se">\</span>
  jq -r <span class="s1">'.result."user-id"'</span>
001010111
</code></pre>
<pre class="highlight python"><code><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_userid</span><span class="p">()</span>
<span class="s">u'001010111'</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">auth/get-userid</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w">
</span><span class="s">"001010111"</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<p>The following user data is made available by the LCMAP clients:</p>

<ul>
<li>API token</li>
<li>ERS username</li>
<li>ERS and LCMAP roles for the user</li>
<li>ERS primary email address</li>
<li>ERS user id</li>
</ul>

<aside class="info">
To parse the JSON results from cURL via the command line, the <code>jq</code>  utility is being used. See the <a href="https://stedolan.github.io/jq/">jq site</a> for more details.
</aside>

          <h1 id="api-data-queries">API: Data Queries</h1>

<p>The following subsections provide documentation for querying the Earth data that is stored in the LCMAP system.</p>

<p>LCMAP data are processed to a level that enables direct use in quantitative applications including:</p>

<ul>
<li>Exploratory data analysis</li>
<li>Numerical modeling</li>
<li>Geospatial, multispectral, and multi-temporal manipulation</li>
</ul>

<p>These are made available for purposes of data reduction, analysis, and interpretation. Characteristics of these data include:</p>

<ul>
<li>Scaled or standardized physical units and data types</li>
<li>Consistent spatial coverage and cartographic projection</li>
<li>Common data formats and accompanying metadata of sufficient detail on data provenance, geographic extent, scaling coefficients, and processing history</li>
</ul>

<p>These are provided in order to enable independent reconstruction of the dataset.</p>

<h2 id="surface-reflectance">Surface Reflectance</h2>

<h2 id="top-of-atmostphere">Top of Atmostphere</h2>

<h2 id="per-pixel-qa-data">Per-pixel QA Data</h2>

<h2 id="ccdc-data">CCDC Data</h2>

          <h1 id="api-subscriptions">API: Subscriptions</h1>

<p>The capabilities provided by the LCMAP subscribtion and notification system
allow users to customize the means by which they are alerted of land change
(and related) events about which they care most.</p>

<p>Users may subscribe to LCMAP events that are tracked for any of the following:</p>

<ul>
<li>Data Ingest and Curation</li>
<li>Model Execution and Predictive Analysis</li>
<li>Updates to the LCMAP System</li>
</ul>

<h2 id="event-types">Event Types</h2>

<h2 id="event-subscription">Event Subscription</h2>

<h2 id="custom-events">Custom Events</h2>

          <h1 id="api-models">API: Models</h1>

<p>The LCMAP Science Execution Environment provides a highly parallel and scalable system to apply science models to batches and streams of data. The associated services have been designed for the ability to be distributed globally. The execution environment handles the efficient and fair scheduling of execution  science models in a widely distributed data-intensive environment.</p>

<aside class="info">
All of the models return a hypermedia link immediately, adhering to the principles of [HATEOAS](https://en.wikipedia.org/wiki/HATEOAS).
</aside>

<p>The supported models to-date are the following:</p>

<ul>
<li>Sample models:

<ul>
<li>OS process model <span class="status-alpha">[ALPHA]</span></li>
<li>Docker process model <span class="status-in-progress">[IN PROGRESS]</span></li>
<li>Mesos Docker model <span class="status-not-started">[NOT STARTED]</span></li>
<li>Mesos framework model <span class="status-not-started">[NOT STARTED]</span></li>
</ul></li>
<li>Continuous Change Detection and Classification (CCDC) <span class="status-initial-stages">[INITIAL STAGES]</span></li>
</ul>

<h2 id="sample-models">SAMPLE MODELS</h2>

<aside class="caution">
In order to execute models on the LCMAP system, you have to have been granted permission to do so for the specific model in question.
</aside>

<h2 id="bull-sample-os-process-model">&bull; Sample: OS Process Model</h2>

<blockquote>
<p>Execute the sample process model for the year <code class="prettyprint">2017</code>, setting the results to delay for 2 minutes:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span><span class="nv">RESULT_PATH</span><span class="o">=</span><span class="k">$(</span>curl -s -X POST <span class="se">\</span>
    -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> -H <span class="s2">"</span><span class="nv">$LCMAP_TOKEN_HDR</span><span class="s2">"</span> <span class="se">\</span>
    -d <span class="s2">"seconds=120"</span> -d <span class="s2">"year=2017"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">LCMAP_ENDPOINT</span><span class="k">}</span><span class="s2">/api/models/sample/os-process"</span> | <span class="se">\</span>
    jq -r <span class="s1">'.result.link.href'</span><span class="k">)</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nv">$RESULT_PATH</span>
/api/jobs/sample/os-process/6d65033bb2007959174dd284ea8070f4
</code></pre>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">lcmap_client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">os_process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2017</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="s">"link"</span><span class="p">][</span><span class="s">"href"</span><span class="p">]</span>
<span class="s">u'/api/jobs/sample/os-process/6d65033bb2007959174dd284ea8070f4'</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">lcmap-client.models.sample-os-process</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">sample-model</span><span class="p">])</span><span class="w">
</span><span class="n">nil</span><span class="w">
</span><span class="n">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">(</span><span class="nf">sample-model/run</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="no">:year</span><span class="w"> </span><span class="mi">2017</span><span class="w"> </span><span class="no">:delay</span><span class="w"> </span><span class="mi">120</span><span class="p">))</span><span class="w">
</span><span class="o">#</span><span class="ss">'result</span><span class="w">
</span><span class="n">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">get-in</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">[</span><span class="no">:result</span><span class="w"> </span><span class="no">:link</span><span class="w"> </span><span class="no">:href</span><span class="p">])</span><span class="w">
</span><span class="s">"/api/jobs/sample/os-process/6d65033bb2007959174dd284ea8070f4"</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>Check on the status of the model run:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -v -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> -H <span class="s2">"</span><span class="nv">$LCMAP_TOKEN_HDR</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">LCMAP_ENDPOINT</span><span class="k">}${</span><span class="nv">RESULT_PATH</span><span class="k">}</span><span class="s2">"</span>
...
&lt; HTTP/1.1 202 Accepted
...
<span class="o">{</span><span class="s2">"result"</span>:<span class="s2">"pending"</span><span class="o">}</span>
</code></pre>
<pre class="highlight python"><code><span class="c"># When you know the result contains a link, you can use the follow_link method</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_link</span><span class="p">()</span><span class="o">.</span><span class="n">result</span>
<span class="s">'pending'</span>
<span class="c"># If you would like to see all of the response data, you can do this:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_link</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
<span class="p">{</span><span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span> <span class="s">'result'</span><span class="p">:</span> <span class="s">'pending'</span><span class="p">,</span> <span class="s">'status'</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">lcmap-client.http</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">http</span><span class="p">])</span><span class="w">
</span><span class="c1">; When you know the result contains a link, you can use the follow-link
; function
</span><span class="n">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">http/follow-link</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="no">:result</span><span class="w"> </span><span class="s">"pending"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>After the job has finished, <code class="prettyprint">GET</code>ing the result resource will return actual data:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -v -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> -H <span class="s2">"</span><span class="nv">$LCMAP_TOKEN_HDR</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">LCMAP_ENDPOINT</span><span class="k">}${</span><span class="nv">RESULT_PATH</span><span class="k">}</span><span class="s2">"</span>
...
&lt; HTTP/1.1 200 OK
...
<span class="o">{</span><span class="s2">"result"</span>:<span class="s2">"                             2017</span><span class="se">\n\n</span><span class="s2">
  ...}
</span></code></pre>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">follow_link</span><span class="p">()</span><span class="o">.</span><span class="n">result</span>
<span class="s">'                            2017</span><span class="se">\n</span><span class="s"> ...'</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">http/follow-link</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="no">:result_id</span><span class="w"> </span><span class="s">"6974c65f54d3cfb453d8137714bcc741"</span><span class="w">
 </span><span class="no">:result</span><span class="w"> </span><span class="s">"                            2017\n ..."</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<p>This sample model simply executes an arbitrary binary (in this case, the <code class="prettyprint">cal</code> program) as an OS process on a single core.</p>

<aside class="info">
Note that subsequent calls with the same parameters will return immediately, since the results are automatically stored in the database and checked before executing a model.
</aside>

<h2 id="bull-sample-docker-process-model">&bull; Sample: Docker Process Model</h2>

<blockquote>
<p>Execute the sample Docker process model for the year <code class="prettyprint">2017</code>, setting the results to delay for 2 minutes:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span><span class="nv">RESULT_PATH</span><span class="o">=</span><span class="k">$(</span>curl -s -X POST <span class="se">\</span>
    -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> -H <span class="s2">"</span><span class="nv">$LCMAP_TOKEN_HDR</span><span class="s2">"</span> <span class="se">\</span>
    -d <span class="s2">"docker-tag=usgs-lcmap/debian-docker-sample-process"</span> <span class="se">\</span>
    -d <span class="s2">"year=2017"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">LCMAP_ENDPOINT</span><span class="k">}</span><span class="s2">/api/models/sample/docker-process"</span> | <span class="se">\</span>
    jq -r <span class="s1">'.result.link.href'</span><span class="k">)</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nv">$RESULT_PATH</span>
/api/jobs/sample/os-process/439ae2866a39bb5cbbe934583bfef114
</code></pre>
<pre class="highlight python"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">TBD</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>Check on the status of the model run:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -v -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> -H <span class="s2">"</span><span class="nv">$LCMAP_TOKEN_HDR</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">LCMAP_ENDPOINT</span><span class="k">}${</span><span class="nv">RESULT_PATH</span><span class="k">}</span><span class="s2">"</span>
...
&lt; HTTP/1.1 202 Accepted
...
<span class="o">{</span><span class="s2">"result"</span>:<span class="s2">"pending"</span><span class="o">}</span>
</code></pre>
<pre class="highlight python"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">TBD</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<blockquote>
<p>After the job has finished, <code class="prettyprint">GET</code>ing the result resource will return actual data:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>curl -v -H <span class="s2">"</span><span class="nv">$LCMAP_VERSION_HDR</span><span class="s2">"</span> -H <span class="s2">"</span><span class="nv">$LCMAP_TOKEN_HDR</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">LCMAP_ENDPOINT</span><span class="k">}${</span><span class="nv">RESULT_PATH</span><span class="k">}</span><span class="s2">"</span>
...
&lt; HTTP/1.1 200 OK
...
<span class="o">{</span><span class="s2">"result"</span>:<span class="s2">"                             2017</span><span class="se">\n\n</span><span class="s2">
  ...}
</span></code></pre>
<pre class="highlight python"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">TBD</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">TBD</span>
</code></pre>

<p>Similar in nature to the OS Process Sample Model, this sample model executes a
model by running a single Docker container. This sample is useful in that it
provides an example of the simplest case where a parameterized Docker image may
be executed remotely via API calls and then both storing and returning the
computed results.</p>

<p>However, in order to do this a certain amout of setup needs to be done. In
particular:</p>

<ul>
<li><code class="prettyprint">git clone</code> the <a href="https://github.com/USGS-EROS/lcmap-dockerfiles">LCMAP Dockerfiles</a> repository</li>
<li>Build the sample Docker image with <code class="prettyprint">make sample-docker-model</code> (from inside the <code class="prettyprint">lcmap-dockerfiles</code> directory)</li>
<li>Make sure that the Docker image is built on the machine where the LCMAP REST server is running</li>
</ul>

<p>Note that the sample model for running a Docker process on the LCMAP REST
server is essentially executing the command <code class="prettyprint">docker run -t usgs-lcmap/debian-docker-sample-process --year 2017</code>,
or whatever docker tag and year you happen to pass as arguments. To be clear,
this is an example of running a parameterized Docker image taking the single
parameter <code class="prettyprint">year</code> which gets passed to the Docker entrypoint on the running
container.</p>

<p>Full science models that use parameterized Docker containers will support a
(potentially) great number of parameters to be passed to a running container in
order to execute the science model appropriately (as intended by its creators).</p>

<h2 id="bull-sample-mesos-docker-model">&bull; Sample: Mesos Docker Model</h2>

<blockquote>
<p>Execute the sample Docker Mesos model for the year <code class="prettyprint">2017</code>, setting the results to delay for 2 minutes:</p>
</blockquote>
<pre class="highlight shell"><code>TBD
</code></pre>

<p>This sample model executes a Docker container across agent nodes in a Mesos cluster. Model parameters are split across a configurable number of nodes and results are combined in the final step of model execution.</p>

<h2 id="bull-sample-mesos-framework-model">&bull; Sample: Mesos Framework Model</h2>

<blockquote>
<p>Execute the sample Mesos framework model for the year <code class="prettyprint">2017</code>, setting the results to delay for 2 minutes:</p>
</blockquote>
<pre class="highlight shell"><code>TBD
</code></pre>

<p>This sample model executes a Mesos framework which has been tuned to parallelize on both the science model parameters and the required queries to the data warehouse. It is this combination of factors which are used to split work across a configurable number of nodes. Results are combined in the final step of model execution.</p>

<h2 id="continuous-change-detection-and-classification">CONTINUOUS CHANGE DETECTION AND CLASSIFICATION</h2>

<p>Continuous Change Detection and Classification (CCDC) is an algorithm for analyzing land cover using Landsat data. It is capable of detecting many kinds of land cover change continuously as new images are collected and providing land cover maps for any given time.</p>

<p>A two-step cloud, cloud shadow, and snow masking algorithm is used for eliminating &ldquo;noisy&rdquo; observations.</p>

<p>A time series model that has components of seasonality, trend, and break estimates surface reflectance and brightness temperature. The time series model is updated dynamically with newly acquired observations.</p>

<p>Due to the differences in spectral response for various kinds of land cover change, the CCDC algorithm uses a threshold derived from all seven Landsat bands. When the difference between observed and predicted images exceeds a threshold six consecutive times, a pixel is identified as land surface change.</p>

<h2 id="bull-ccdc-execution">&bull; CCDC Execution</h2>

<blockquote>
<p>Generate a CCDC model for the given extents, time-range, and &hellip;:</p>
</blockquote>
<pre class="highlight shell"><code>TBD
</code></pre>

<h2 id="bull-ccdc-results-storage">&bull; CCDC Results Storage</h2>

<p>TBD</p>

<h2 id="bull-ccdc-prediction">&bull; CCDC Prediction</h2>

<p>TBD</p>

          <h1 id="api-management">API: Management</h1>

<aside class="caution">
Only users with the superuser role may make management calls to the LCMAP services.
</aside>

<h2 id="status">Status</h2>

<h2 id="permissions">Permissions</h2>

<h2 id="roles">Roles</h2>

<h2 id="users">Users</h2>

          <h1 id="compatibility">Compatibility</h1>

<p>The following sections provide documentation on supported compatibility layers.</p>

          <h2 id="wmts">WMTS</h2>

<p>The Web Map Tile Service (WMTS) described in the <a href="http://www.opengeospatial.org/standards/wmts">Open Geospatial Consortium</a>&rsquo;s <a href="http://www.opengeospatial.org/standards/wmts">OpenGIS Web Map Tile Service Implementation Standard</a> builds on earlier efforts to develop scalable, high performance services for web based distribution of cartographic maps. WMTS is inspired by the <a href="http://wiki.osgeo.org/index.php/Tile_Map_Service_Specification">OSGeo Tile Map Service Specification</a>. The team that worked on this standard also considered similar initiatives, such as Google maps and NASA OnEarth.</p>

<p>WMTS is the means by which LCMAP offers <a href="http://qgis.org/en/site/">QGIS</a> integration.</p>

<h2 id="bull-capabilities-resource">&bull; Capabilities Resource</h2>

<h2 id="bull-servicemetadata-resource">&bull; ServiceMetadata Resource</h2>

<h2 id="bull-tile-resource">&bull; Tile Resource</h2>

<h2 id="bull-featureinfo-resource">&bull; FeatureInfo Resource</h2>

          <h1 id="user-agent">User Agent</h1>

<blockquote>
<p>The LCMAP clients user agent string:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># The cURL user agent string is used without alteration</span>
</code></pre>
<pre class="highlight python"><code><span class="n">Python</span><span class="p">:</span> <span class="n">TBD</span>
</code></pre>
<pre class="highlight vb"><code><span class="n">Julia</span><span class="p">:</span> <span class="n">TBD</span>
</code></pre>
<pre class="highlight clojure"><code><span class="n">Clojure</span><span class="err">:</span><span class="w"> </span><span class="n">TBD</span><span class="w">
</span></code></pre>
<pre class="highlight ruby"><code><span class="no">Ruby</span><span class="p">:</span> <span class="no">TBD</span>
</code></pre>

<p>Each client provides a user agent string that identifies it and provides contextual information (e.g., version and location of source code.</p>

<p>The exact value of the user agent string will differ depending upon the client library you have selected.</p>

          <h1 id="previous-versions">Previous Versions</h1>

<p>Documentation is available for all previous releases:</p>

<ul>
<li><a href="../current/">Development version</a></li>
<li><a href="../v0.0/">v0.0</a> (Prototype)</li>
</ul>

          <h1 id="license">License</h1>

<p>Copyright &copy; 2015 USGS EROS</p>

<p>[TBD]</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">cURL</a>
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="vb">Julia</a>
                <a href="#" data-language-name="clojure">Clojure</a>
                <a href="#" data-language-name="ruby">Ruby</a>
          </div>
      </div>
    </div>
  </body>
</html>
